---
# Create account keys
- name: Create ECC256 account key
  command: openssl ecparam -name prime256v1 -genkey -out {{ output_dir }}/account-ec256.pem
- name: Create ECC384 account key
  command: openssl ecparam -name secp384r1 -genkey -out {{ output_dir }}/account-ec384.pem
- name: Create RSA-2048 account key
  command: openssl genrsa -out {{ output_dir }}/account-rsa2048.pem 2048
- name: Wait until controller is up and running
  uri:
    url: http://{{ acme_host }}:5000
    validate_certs: no
  register: check_controller_started
  until: check_controller_started is success
  retries: 20
  delay: 1
  ignore_errors: yes
- name: Wait until pebble is up and running
  uri:
    url: https://{{ acme_host }}:14000/dir
    validate_certs: no
  register: check_pebble_started
  until: check_pebble_started is success
  retries: 20
  delay: 1
  ignore_errors: yes
